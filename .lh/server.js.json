{
    "sourceFile": "server.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1763453411731,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763453649666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,9 +93,9 @@\n db.once('open', async () => {\r\n     console.log('Connected to MongoDB');\r\n     await initializeMongoDBData();\r\n     await startServer();\r\n-    await initializeCassandraData()\r\n+    await initializeCassandraData(client)\r\n });\r\n \r\n // User schema\r\n const userSchema = new mongoose.Schema({\r\n"
                },
                {
                    "date": 1763635013826,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,15 +3,21 @@\n const bodyParser = require('body-parser');\r\n const path = require('path');\r\n const cassandra = require('cassandra-driver');\r\n \r\n+\r\n+const app = express();\r\n+const PORT = 3000;\r\n+\r\n+app.use(bodyParser.json());\r\n+app.use(bodyParser.urlencoded({ extended: true }));\r\n+app.use(express.static('public'));\r\n+\r\n+const MONGO_URI = process.env.MONGO_URI || 'mongodb://mongo:27017/testdb';\r\n+\r\n const client = new cassandra.Client({\r\n-  contactPoints: ['localhost:9042'],\r\n-  localDataCenter: 'datacenter1',\r\n-  socketOptions: {\r\n-    readTimeout: 10000, // 30 seconds\r\n-    connectTimeout: 10000\r\n-  }\r\n+  contactPoints: [process.env.CASSANDRA_CONTACT_POINTS || 'cassandra:9042'],\r\n+  localDataCenter: 'datacenter1'\r\n });\r\n \r\n async function startServer() {\r\n   try {\r\n@@ -25,8 +31,10 @@\n     console.error('Failed to start server:', error);\r\n   }\r\n }\r\n \r\n+\r\n+\r\n async function initializeCassandraData(client) {\r\n     try {\r\n         await client.execute(`\r\n             CREATE KEYSPACE IF NOT EXISTS auth_system \r\n@@ -71,19 +79,11 @@\n     }\r\n }\r\n \r\n \r\n-const app = express();\r\n-const PORT = 3000;\r\n \r\n-app.use(bodyParser.json());\r\n-app.use(bodyParser.urlencoded({ extended: true }));\r\n-app.use(express.static('public'));\r\n \r\n-const MONGO_URI = 'mongodb://localhost:27017/testdb';\r\n \r\n-\r\n-\r\n mongoose.connect(MONGO_URI, {\r\n     useNewUrlParser: true,\r\n     useUnifiedTopology: true\r\n });\r\n"
                },
                {
                    "date": 1763635124051,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,244 +3,110 @@\n const bodyParser = require('body-parser');\r\n const path = require('path');\r\n const cassandra = require('cassandra-driver');\r\n \r\n-\r\n const app = express();\r\n const PORT = 3000;\r\n \r\n app.use(bodyParser.json());\r\n app.use(bodyParser.urlencoded({ extended: true }));\r\n app.use(express.static('public'));\r\n \r\n const MONGO_URI = process.env.MONGO_URI || 'mongodb://mongo:27017/testdb';\r\n+const CASSANDRA_CONTACT_POINTS = process.env.CASSANDRA_CONTACT_POINTS || 'cassandra:9042';\r\n \r\n-const client = new cassandra.Client({\r\n-  contactPoints: [process.env.CASSANDRA_CONTACT_POINTS || 'cassandra:9042'],\r\n-  localDataCenter: 'datacenter1'\r\n+const cassandraClient = new cassandra.Client({\r\n+    contactPoints: [CASSANDRA_CONTACT_POINTS],\r\n+    localDataCenter: 'datacenter1'\r\n });\r\n \r\n-async function startServer() {\r\n-  try {\r\n-    await client.connect();\r\n-    await initializeCassandraData(client);\r\n-    \r\n-    app.listen(3000, () => {\r\n-      console.log('App running on http://localhost:3000');\r\n-    });\r\n-  } catch (error) {\r\n-    console.error('Failed to start server:', error);\r\n-  }\r\n-}\r\n-\r\n-\r\n-\r\n-async function initializeCassandraData(client) {\r\n-    try {\r\n-        await client.execute(`\r\n-            CREATE KEYSPACE IF NOT EXISTS auth_system \r\n-            WITH replication = { 'class': 'SimpleStrategy', 'replication_factor': 1 }\r\n-        `);\r\n-        \r\n-        await client.execute('USE auth_system');\r\n-        \r\n-        await client.execute(`\r\n-            CREATE TABLE IF NOT EXISTS users (\r\n-                username text PRIMARY KEY,\r\n-                password text,\r\n-                role text,\r\n-                secret text\r\n-            )\r\n-        `);\r\n-        \r\n-        await client.execute('TRUNCATE users');\r\n-\r\n-        const queries = [\r\n-            {\r\n-                query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)',\r\n-                params: ['admin', 'admin_testing', 'admin', 'CTF{n0sql_byp455}']\r\n-            },\r\n-            {\r\n-                query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)',\r\n-                params: ['user1', 'password1', 'user', 'Nothing to see here']\r\n-            },\r\n-            {\r\n-                query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)',\r\n-                params: ['test', 'test', 'user', 'Regular user secret']\r\n-            }\r\n-        ];\r\n-        \r\n-        for (const { query, params } of queries) {\r\n-            await client.execute(query, params, { prepare: true });\r\n-        }\r\n-\r\n-        console.log('Data initialized');\r\n-    } catch (err) {\r\n-        console.error('Error initializing data:', err);\r\n-    }\r\n-}\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-mongoose.connect(MONGO_URI, {\r\n-    useNewUrlParser: true,\r\n-    useUnifiedTopology: true\r\n-});\r\n-\r\n-const db = mongoose.connection;\r\n-db.on('error', console.error.bind(console, 'MongoDB connection error:'));\r\n-db.once('open', async () => {\r\n-    console.log('Connected to MongoDB');\r\n-    await initializeMongoDBData();\r\n-    await startServer();\r\n-    await initializeCassandraData(client)\r\n-});\r\n-\r\n-// User schema\r\n const userSchema = new mongoose.Schema({\r\n     username: String,\r\n     password: String,\r\n     role: String,\r\n-    secret: String,\r\n+    secret: String\r\n });\r\n \r\n-const User = mongoose.model('User', userSchema);\r\n+const UserModel = mongoose.model('User', userSchema);\r\n \r\n+async function initializeMongoData() {\r\n+    await UserModel.deleteMany({});\r\n+    await UserModel.create([\r\n+        { username: 'admin', password: 'admin_testing', role: 'admin', secret: 'CTF{n0sql_byp455}' },\r\n+        { username: 'user1', password: 'password1', role: 'user', secret: 'No flag for regular users' },\r\n+        { username: 'test', password: 'test', role: 'user', secret: 'Still no flag' }\r\n+    ]);\r\n+}\r\n \r\n-\r\n-async function initializeMongoDBData() {\r\n-    try {\r\n-        await User.deleteMany({});\r\n-\r\n-        await User.create([\r\n-            {\r\n-                username: 'admin',\r\n-                password: 'admin_testing',\r\n-                role: 'admin',\r\n-                secret: 'CTF{n0sql_byp455}',\r\n-            },\r\n-            {\r\n-                username: 'user1',\r\n-                password: 'password1',\r\n-                role: 'user',\r\n-                secret: 'Nothing to see here',\r\n-                secret: 'No flag for regular users'\r\n-            },\r\n-            {\r\n-                username: 'test',\r\n-                password: 'test',\r\n-                role: 'user',\r\n-                secret: 'Regular user secret',\r\n-                secret: 'Still no flag'\r\n-            }\r\n-        ]);\r\n-\r\n-        console.log('data initialized');\r\n-    } catch (err) {\r\n-        console.error('error initializing data:', err);\r\n+async function initializeCassandraData() {\r\n+    await cassandraClient.execute(`\r\n+        CREATE KEYSPACE IF NOT EXISTS auth_system\r\n+        WITH replication = { 'class': 'SimpleStrategy', 'replication_factor': 1 }\r\n+    `);\r\n+    await cassandraClient.execute('USE auth_system');\r\n+    await cassandraClient.execute(`\r\n+        CREATE TABLE IF NOT EXISTS users (\r\n+            username text PRIMARY KEY,\r\n+            password text,\r\n+            role text,\r\n+            secret text\r\n+        )\r\n+    `);\r\n+    await cassandraClient.execute('TRUNCATE users');\r\n+    const queries = [\r\n+        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['admin', 'admin_testing', 'admin', 'CTF{n0sql_byp455}'] },\r\n+        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['user1', 'password1', 'user', 'Nothing to see here'] },\r\n+        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['test', 'test', 'user', 'Regular user secret'] }\r\n+    ];\r\n+    for (const { query, params } of queries) {\r\n+        await cassandraClient.execute(query, params, { prepare: true });\r\n     }\r\n }\r\n \r\n-app.get('/', (req, res) => {\r\n-    res.sendFile(path.join(__dirname, 'public', 'index.html'));\r\n+mongoose.connect(MONGO_URI, { useNewUrlParser: true, useUnifiedTopology: true });\r\n+mongoose.connection.once('open', async () => {\r\n+    await initializeMongoData();\r\n+    await cassandraClient.connect();\r\n+    await initializeCassandraData();\r\n+    app.listen(PORT, () => console.log(`Server running on http://localhost:${PORT}`));\r\n });\r\n \r\n-app.get('/level1', (req, res) => {\r\n-    res.sendFile(path.join(__dirname, 'public', 'level1.html'));\r\n-});\r\n+app.get('/', (req, res) => res.sendFile(path.join(__dirname, 'public', 'index.html')));\r\n+app.get('/level1', (req, res) => res.sendFile(path.join(__dirname, 'public', 'level1.html')));\r\n+app.get('/level2', (req, res) => res.sendFile(path.join(__dirname, 'public', 'level2.html')));\r\n+app.get('/level3', (req, res) => res.sendFile(path.join(__dirname, 'public', 'level3.html')));\r\n \r\n-app.get('/level2', (req, res) => {\r\n-    res.sendFile(path.join(__dirname, 'public', 'level2.html'));\r\n+app.post('/level1/login', async (req, res) => {\r\n+    const { username, password } = req.body;\r\n+    const query = { $where: `this.username == '${username}' && this.password == '${password}'` };\r\n+    const users = await UserModel.find(query);\r\n+    if (users.length > 0) {\r\n+        res.json({ success: true, message: 'Login successful', secret: users[0].secret });\r\n+    } else {\r\n+        res.status(401).json({ success: false, message: 'Invalid credentials' });\r\n+    }\r\n });\r\n \r\n-app.get('/level3', (req, res) => {\r\n-    res.sendFile(path.join(__dirname, 'public', 'level3.html'));\r\n+app.post('/level2/login', async (req, res) => {\r\n+    const users = await UserModel.find(req.body);\r\n+    if (users.length > 0) {\r\n+        res.json({ success: true, message: 'Login successful', secret: users[0].secret });\r\n+    } else {\r\n+        res.status(401).json({ success: false, message: 'Invalid credentials' });\r\n+    }\r\n });\r\n \r\n-\r\n-app.post('/level1/login', async (req, res) => {\r\n+app.post('/level3/login', async (req, res) => {\r\n+    const { username, password } = req.body;\r\n     try {\r\n-        const username = req.body.username;\r\n-        const password = req.body.password;\r\n-\r\n-        const query = { $where: `this.username == '${username}' && this.password == '${password}'`  };\r\n-        \r\n-        const users = await User.find(query);\r\n-        \r\n-        if (users && users.length > 0) {\r\n-            const user = users[0];\r\n-            res.json({\r\n-                success: true,\r\n-                message: 'Login successful',\r\n-                secret: user.secret\r\n-            });\r\n+        const result = await cassandraClient.execute(\r\n+            `SELECT * FROM users WHERE username='${username}' AND password='${password}' ALLOW FILTERING`\r\n+        );\r\n+        if (result.rows.length > 0) {\r\n+            res.json({ success: true, message: 'Login successful', secret: result.rows[0].secret });\r\n         } else {\r\n-            res.status(401).json({\r\n-                success: false,\r\n-                message: 'Invalid credentials'\r\n-            });\r\n+            res.status(401).json({ success: false, message: 'Invalid credentials' });\r\n         }\r\n     } catch (err) {\r\n-        res.status(500).json({ error: 'Database error' });\r\n+        res.status(500).json({ error: err.message });\r\n     }\r\n });\r\n-\r\n-app.post('/level2/login', (req, res) => {\r\n-    const credentials = req.body;\r\n-    \r\n-    User.find(credentials)\r\n-        .then(users => {\r\n-            if (users && users.length > 0) {\r\n-                const user = users[0];\r\n-                res.json({\r\n-                    success: true,\r\n-                    message: 'Login successful',\r\n-                    secret: user.secret\r\n-                });\r\n-            } else {\r\n-                res.status(401).json({\r\n-                    success: false,\r\n-                    message: 'Invalid credentials'\r\n-                });\r\n-            }\r\n-        })\r\n-        .catch(err => {\r\n-            res.status(500).json({ error: 'Database error' });\r\n-        });\r\n-});\r\n-\r\n-app.post('/level3/login', async (req, res) => {\r\n-  const { username, password } = req.body;\r\n-  \r\n-  try {\r\n-    const query = `SELECT * FROM users WHERE username='${username}' AND password='${password}' ALLOW FILTERING`;\r\n-    const result = await client.execute(query);\r\n-    \r\n-    if (result.rows.length > 0) {\r\n-      const user = result.rows[0];\r\n-      \r\n-      res.json({\r\n-        success: true,\r\n-        message: 'Login successful',\r\n-        secret: user.secret  \r\n-      });\r\n-    } else {\r\n-      res.status(401).json({\r\n-        success: false,\r\n-        message: 'Invalid credentials'\r\n-      });\r\n-    }\r\n-  } catch (error) {\r\n-    res.status(500).json({ error: error.message });\r\n-  }\r\n-    return {};\r\n-});\r\n-\r\n-\r\n-\r\n-app.listen(PORT, () => {\r\n-    console.log(`server running on http://localhost:${PORT}`);\r\n-});\r\n-\r\n-\r\n"
                },
                {
                    "date": 1763636721229,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,8 +27,13 @@\n });\r\n \r\n const UserModel = mongoose.model('User', userSchema);\r\n \r\n+\r\n+const waitPort = require('wait-port');\r\n+\r\n+\r\n+\r\n async function initializeMongoData() {\r\n     await UserModel.deleteMany({});\r\n     await UserModel.create([\r\n         { username: 'admin', password: 'admin_testing', role: 'admin', secret: 'CTF{n0sql_byp455}' },\r\n@@ -61,16 +66,24 @@\n         await cassandraClient.execute(query, params, { prepare: true });\r\n     }\r\n }\r\n \r\n-mongoose.connect(MONGO_URI, { useNewUrlParser: true, useUnifiedTopology: true });\r\n-mongoose.connection.once('open', async () => {\r\n+\r\n+async function startServer() {\r\n+    await waitPort({ host: 'mongo', port: 27017 });\r\n+    await waitPort({ host: 'cassandra', port: 9042 });\r\n+\r\n+    await mongoose.connect(MONGO_URI, { useNewUrlParser: true, useUnifiedTopology: true });\r\n     await initializeMongoData();\r\n+\r\n     await cassandraClient.connect();\r\n     await initializeCassandraData();\r\n+\r\n     app.listen(PORT, () => console.log(`Server running on http://localhost:${PORT}`));\r\n-});\r\n+}\r\n \r\n+startServer().catch(err => console.error(err));\r\n+\r\n app.get('/', (req, res) => res.sendFile(path.join(__dirname, 'public', 'index.html')));\r\n app.get('/level1', (req, res) => res.sendFile(path.join(__dirname, 'public', 'level1.html')));\r\n app.get('/level2', (req, res) => res.sendFile(path.join(__dirname, 'public', 'level2.html')));\r\n app.get('/level3', (req, res) => res.sendFile(path.join(__dirname, 'public', 'level3.html')));\r\n"
                },
                {
                    "date": 1763636785437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n const mongoose = require('mongoose');\r\n const bodyParser = require('body-parser');\r\n const path = require('path');\r\n const cassandra = require('cassandra-driver');\r\n+const waitPort = require('wait-port');\r\n \r\n const app = express();\r\n const PORT = 3000;\r\n \r\n"
                },
                {
                    "date": 1763636908132,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,12 +29,8 @@\n \r\n const UserModel = mongoose.model('User', userSchema);\r\n \r\n \r\n-const waitPort = require('wait-port');\r\n-\r\n-\r\n-\r\n async function initializeMongoData() {\r\n     await UserModel.deleteMany({});\r\n     await UserModel.create([\r\n         { username: 'admin', password: 'admin_testing', role: 'admin', secret: 'CTF{n0sql_byp455}' },\r\n"
                },
                {
                    "date": 1763638256025,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,11 +32,11 @@\n \r\n async function initializeMongoData() {\r\n     await UserModel.deleteMany({});\r\n     await UserModel.create([\r\n-        { username: 'admin', password: 'admin_testing', role: 'admin', secret: 'CTF{n0sql_byp455}' },\r\n-        { username: 'user1', password: 'password1', role: 'user', secret: 'No flag for regular users' },\r\n-        { username: 'test', password: 'test', role: 'user', secret: 'Still no flag' }\r\n+        { username: 'admin', password: 'admin_testing', role: 'admin', secret: 'FLAG{n0sql_byp455}' },\r\n+        { username: 'user1', password: 'password1', role: 'user', secret: 'nop' },\r\n+        { username: 'test', password: 'test', role: 'user', secret: 'nop' }\r\n     ]);\r\n }\r\n \r\n async function initializeCassandraData() {\r\n"
                },
                {
                    "date": 1763638273965,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,11 +54,11 @@\n         )\r\n     `);\r\n     await cassandraClient.execute('TRUNCATE users');\r\n     const queries = [\r\n-        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['admin', 'admin_testing', 'admin', 'CTF{n0sql_byp455}'] },\r\n-        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['user1', 'password1', 'user', 'Nothing to see here'] },\r\n-        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['test', 'test', 'user', 'Regular user secret'] }\r\n+        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['admin', 'admin_testing', 'admin', 'FLAG{n0sql_byp455}'] },\r\n+        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['user1', 'password1', 'user', 'nop'] },\r\n+        { query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)', params: ['test', 'test', 'user', 'nop'] }\r\n     ];\r\n     for (const { query, params } of queries) {\r\n         await cassandraClient.execute(query, params, { prepare: true });\r\n     }\r\n"
                }
            ],
            "date": 1763453411731,
            "name": "Commit-0",
            "content": "const express = require('express');\r\nconst mongoose = require('mongoose');\r\nconst bodyParser = require('body-parser');\r\nconst path = require('path');\r\nconst cassandra = require('cassandra-driver');\r\n\r\nconst client = new cassandra.Client({\r\n  contactPoints: ['localhost:9042'],\r\n  localDataCenter: 'datacenter1',\r\n  socketOptions: {\r\n    readTimeout: 10000, // 30 seconds\r\n    connectTimeout: 10000\r\n  }\r\n});\r\n\r\nasync function startServer() {\r\n  try {\r\n    await client.connect();\r\n    await initializeCassandraData(client);\r\n    \r\n    app.listen(3000, () => {\r\n      console.log('App running on http://localhost:3000');\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to start server:', error);\r\n  }\r\n}\r\n\r\nasync function initializeCassandraData(client) {\r\n    try {\r\n        await client.execute(`\r\n            CREATE KEYSPACE IF NOT EXISTS auth_system \r\n            WITH replication = { 'class': 'SimpleStrategy', 'replication_factor': 1 }\r\n        `);\r\n        \r\n        await client.execute('USE auth_system');\r\n        \r\n        await client.execute(`\r\n            CREATE TABLE IF NOT EXISTS users (\r\n                username text PRIMARY KEY,\r\n                password text,\r\n                role text,\r\n                secret text\r\n            )\r\n        `);\r\n        \r\n        await client.execute('TRUNCATE users');\r\n\r\n        const queries = [\r\n            {\r\n                query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)',\r\n                params: ['admin', 'admin_testing', 'admin', 'CTF{n0sql_byp455}']\r\n            },\r\n            {\r\n                query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)',\r\n                params: ['user1', 'password1', 'user', 'Nothing to see here']\r\n            },\r\n            {\r\n                query: 'INSERT INTO users (username, password, role, secret) VALUES (?, ?, ?, ?)',\r\n                params: ['test', 'test', 'user', 'Regular user secret']\r\n            }\r\n        ];\r\n        \r\n        for (const { query, params } of queries) {\r\n            await client.execute(query, params, { prepare: true });\r\n        }\r\n\r\n        console.log('Data initialized');\r\n    } catch (err) {\r\n        console.error('Error initializing data:', err);\r\n    }\r\n}\r\n\r\n\r\nconst app = express();\r\nconst PORT = 3000;\r\n\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(express.static('public'));\r\n\r\nconst MONGO_URI = 'mongodb://localhost:27017/testdb';\r\n\r\n\r\n\r\nmongoose.connect(MONGO_URI, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true\r\n});\r\n\r\nconst db = mongoose.connection;\r\ndb.on('error', console.error.bind(console, 'MongoDB connection error:'));\r\ndb.once('open', async () => {\r\n    console.log('Connected to MongoDB');\r\n    await initializeMongoDBData();\r\n    await startServer();\r\n    await initializeCassandraData()\r\n});\r\n\r\n// User schema\r\nconst userSchema = new mongoose.Schema({\r\n    username: String,\r\n    password: String,\r\n    role: String,\r\n    secret: String,\r\n});\r\n\r\nconst User = mongoose.model('User', userSchema);\r\n\r\n\r\n\r\nasync function initializeMongoDBData() {\r\n    try {\r\n        await User.deleteMany({});\r\n\r\n        await User.create([\r\n            {\r\n                username: 'admin',\r\n                password: 'admin_testing',\r\n                role: 'admin',\r\n                secret: 'CTF{n0sql_byp455}',\r\n            },\r\n            {\r\n                username: 'user1',\r\n                password: 'password1',\r\n                role: 'user',\r\n                secret: 'Nothing to see here',\r\n                secret: 'No flag for regular users'\r\n            },\r\n            {\r\n                username: 'test',\r\n                password: 'test',\r\n                role: 'user',\r\n                secret: 'Regular user secret',\r\n                secret: 'Still no flag'\r\n            }\r\n        ]);\r\n\r\n        console.log('data initialized');\r\n    } catch (err) {\r\n        console.error('error initializing data:', err);\r\n    }\r\n}\r\n\r\napp.get('/', (req, res) => {\r\n    res.sendFile(path.join(__dirname, 'public', 'index.html'));\r\n});\r\n\r\napp.get('/level1', (req, res) => {\r\n    res.sendFile(path.join(__dirname, 'public', 'level1.html'));\r\n});\r\n\r\napp.get('/level2', (req, res) => {\r\n    res.sendFile(path.join(__dirname, 'public', 'level2.html'));\r\n});\r\n\r\napp.get('/level3', (req, res) => {\r\n    res.sendFile(path.join(__dirname, 'public', 'level3.html'));\r\n});\r\n\r\n\r\napp.post('/level1/login', async (req, res) => {\r\n    try {\r\n        const username = req.body.username;\r\n        const password = req.body.password;\r\n\r\n        const query = { $where: `this.username == '${username}' && this.password == '${password}'`  };\r\n        \r\n        const users = await User.find(query);\r\n        \r\n        if (users && users.length > 0) {\r\n            const user = users[0];\r\n            res.json({\r\n                success: true,\r\n                message: 'Login successful',\r\n                secret: user.secret\r\n            });\r\n        } else {\r\n            res.status(401).json({\r\n                success: false,\r\n                message: 'Invalid credentials'\r\n            });\r\n        }\r\n    } catch (err) {\r\n        res.status(500).json({ error: 'Database error' });\r\n    }\r\n});\r\n\r\napp.post('/level2/login', (req, res) => {\r\n    const credentials = req.body;\r\n    \r\n    User.find(credentials)\r\n        .then(users => {\r\n            if (users && users.length > 0) {\r\n                const user = users[0];\r\n                res.json({\r\n                    success: true,\r\n                    message: 'Login successful',\r\n                    secret: user.secret\r\n                });\r\n            } else {\r\n                res.status(401).json({\r\n                    success: false,\r\n                    message: 'Invalid credentials'\r\n                });\r\n            }\r\n        })\r\n        .catch(err => {\r\n            res.status(500).json({ error: 'Database error' });\r\n        });\r\n});\r\n\r\napp.post('/level3/login', async (req, res) => {\r\n  const { username, password } = req.body;\r\n  \r\n  try {\r\n    const query = `SELECT * FROM users WHERE username='${username}' AND password='${password}' ALLOW FILTERING`;\r\n    const result = await client.execute(query);\r\n    \r\n    if (result.rows.length > 0) {\r\n      const user = result.rows[0];\r\n      \r\n      res.json({\r\n        success: true,\r\n        message: 'Login successful',\r\n        secret: user.secret  \r\n      });\r\n    } else {\r\n      res.status(401).json({\r\n        success: false,\r\n        message: 'Invalid credentials'\r\n      });\r\n    }\r\n  } catch (error) {\r\n    res.status(500).json({ error: error.message });\r\n  }\r\n    return {};\r\n});\r\n\r\n\r\n\r\napp.listen(PORT, () => {\r\n    console.log(`server running on http://localhost:${PORT}`);\r\n});\r\n\r\n\r\n"
        }
    ]
}